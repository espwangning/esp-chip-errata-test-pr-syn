[ADC-270] SAR ADC 重启后在 DMA 连续转换模式下无法采集到足够数据
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. only:: esp32c3

   .. tags::
      
      v0.0, v0.1, v0.2, v0.3, v0.4, v1.1

描述
^^^^

如果 SAR ADC 在 DMA 连续转换模式下暂停后重启，芯片内部记录 ADC 采样次数的硬件计数器不会自动清零，也没有专用的寄存器可以手动清零。

这可能会导致用户碰到：

- 采样结果乱码
- 采样次数少于配置值

变通方法
^^^^^^^^

在启动 ADC 连续转换模式前：

#. 将 SYSTEM_APB_SARADC_RST 位先置 1 再清 0，从而复位 ADC
#. 将 16 位的 APB_SARADC_APB_ADC_EOF_NUM 字段依次配置为上个配置值至 0 之间的所有值，从而清除 ADC 采样次数计数器的计数值

注意，该流程最多需要约 14 ms。

解决方案
^^^^^^^^

:bdg-warning:`暂无` 修复计划。
